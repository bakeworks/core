{"version":3,"sources":["../../src/models/cache.js"],"names":["module","exports","users","products","productsById","customers","customersById","recipes","recipesByProductId","ingredients","ingredientsByRecipeId","standingOrders","specialOrders","reset","getCustomer","getProduct","init","arg","initUsers","initProducts","initCustomers","initRecipes","initStandingOrders","initSpecialOrders","id","failIfAbsent","customer","get","undefined","Error","product","Map","json","JSON","parse","forEach","set","_id","initIngredients","ingredientsJson","ingredient","product_id","recipeIngredients","recipe_id","push","recipesJson","recipe","resolveOrder","order","customer_id","quantities","quantities_csv","split","map","q","parseInt"],"mappings":"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","sourcesContent":["module.exports = {\n  users,\n  products, productsById,\n  customers, customersById,\n  recipes, recipesByProductId,\n  ingredients, ingredientsByRecipeId,\n  standingOrders, specialOrders,\n  reset,\n  getCustomer,\n  getProduct,\n  init,\n}\n\nvar users = null\nvar products = null\nvar productsById = null\nvar customers = null\nvar customersById = null\nvar recipes = null\nvar recipesByProductId = null\nvar ingredients = null\nvar ingredientsByRecipeId = null\nvar standingOrders = null\nvar specialOrders = null\n\n/*\n  Arg should be an object whose properties are json strings:\n  {\n    users,\n    products,\n    customers,\n    recipes,\n    ingredients,\n    standingOrders,\n    specialOrders\n  }\n  Most likely source is database load (mongodb to json).\n*/\nfunction init(arg) {\n  reset()\n  initUsers(arg.users)\n  initProducts(arg.products)\n  initCustomers(arg.customers)\n  initRecipes(arg.recipes, arg.ingredients)\n  initStandingOrders(arg.standingOrders)\n  initSpecialOrders(arg.specialOrders)\n}\n\nfunction reset() {\n  users =\n  products =\n  productsById =\n  customers =\n  customersById =\n  recipes =\n  recipesByProductId =\n  ingredients =\n  ingredientsByRecipeId =\n  standingOrders =\n  specialOrders = null\n}\n\nfunction getCustomer(id, failIfAbsent = true) {\n  const customer = customersById.get(id)\n  if (customer === undefined && failIfAbsent) throw new Error(`customer #{id} not found`)\n  return customer\n}\n\nfunction getProduct(id, failIfAbsent = true) {\n  const product = productsById.get(id)\n  productsById = new Map()\n  if (product === undefined && failIfAbsent) throw new Error(`product #{id} not found`)\n  return product\n}\n\nfunction initUsers(json) {\n  users = JSON.parse(json)\n}\n\nfunction initProducts(json) {\n  products = JSON.parse(json)\n  products.forEach(product => {\n    productsById.set(product._id, product)\n  })\n}\n\nfunction initCustomers(json) {\n  customers = JSON.parse(json)\n  customersById = new Map()\n  customers.forEach(customer => customersById.set(customer._id, customer))\n}\n\nfunction initIngredients(ingredientsJson) {\n  ingredients = JSON.parse(ingredientsJson)\n  ingredientsByRecipeId = new Map()\n  ingredients.forEach(ingredient => {\n    ingredient.product = getProduct(ingredient.product_id)\n    let recipeIngredients = ingredientsByRecipeId.set(ingredient.recipe_id)\n    if (recipeIngredients === undefined) {\n      recipeIngredients = []\n      ingredientsByRecipeId.set(ingredient.recipe_id, recipeIngredients)\n    }\n    recipeIngredients.push(ingredient)\n  })\n}\n\nfunction initRecipes(recipesJson, ingredientsJson) {\n  initIngredients(ingredientsJson)\n  recipes = JSON.parse(recipesJson)\n  recipesByProductId = new Map()\n  recipes.forEach(recipe => {\n    recipe.product = getProduct(recipe.product_id)\n    recipe.ingredients = ingredientsByRecipeId.get(recipe._id)\n    if (recipe.ingredients === undefined) recipe.ingredients = []\n    recipesByProductId.set(recipe.product_id, recipe)\n  })\n}\n\nfunction resolveOrder(order) {\n  order.product = getProduct(order.product_id)\n  order.customer = getProduct(order.customer_id)\n  order.quantities = order.quantities_csv.split(',').map(q => parseInt(q))\n}\n\nfunction initStandingOrders(json) {\n  standingOrders = JSON.parse(json)\n  standingOrders.forEach(order => resolveOrder(order))\n}\n\nfunction initSpecialOrders(json) {\n  specialOrders = JSON.parse(json)\n  specialOrders.forEach(order => resolveOrder(order))\n}\n"],"file":"cache.js"}